{% extends "base.html" %}
{% load static %}

{% load crispy_forms_tags %}

{% block content %}
<div class="container">
  <div class="row">
    <div class="col-sm-12 col-md-7 mt-2">
      <div class="boxes shadow-sm rounded p-2">
        <div class="boxes post-options dropdown text-end">
          <button class="btn dropdown-toggle rounded-circle position-relative mx-3" type="button"
            data-bs-toggle="dropdown" aria-expanded="false">
            <i class="fa-solid fa-ellipsis position-absolute top-50 start-50 translate-middle"></i>
          </button>
          <ul class="dropdown-menu">
            {% if post.author == user %}
            <li><a class="dropdown-item" href="/posts/edit/{{post.id}}">Edit</a></li>
            <li><a class="dropdown-item" href="/posts/delete/{{post.id}}">Delete</a></li>
            {% else %}
            <li><a class="dropdown-item" href="#">Share post</a>
            <li><a class="dropdown-item" href="#">Report</a></li>
            {% endif %}
          </ul>
        </div>
        <a href="{% url 'view_post' post.slug %}" class="post-link text-decoration-none">
          <div class="author-post d-flex flex-row">
            <div class="w-100">
              <img class="profile-image-post rounded-circle shadow-sm mx-3"
                src="{% static 'img/default-profile-image.png' %}" alt="profile image of author">
              <p class="mx-3 w-100 fs-6">{{post.author}},<span class="small-and-light">{{post.created_on}}</span></p>
            </div>
          </div>
          <h5 class="w-100 text-center">{{post.title}}</h5>
          <p class="text-center">{{post.content}}</p>
          <div class="w-100">
            {% if post.count_likes > 0%}
            <p class="text-start">{{post.count_likes}} Likes</p>
            {% endif %}
            <p class="text-end"></p>
          </div>
        </a>
        <hr class="m-0">
        <div class="row user-post-options m-0">
          <form class="like-btn col-4" action="/posts/like_post/{{post.id}}">
            {% csrf_token %}
            <button class="btn w-100">
              {% if user in post.likes.all %}
              <i class="fa-solid fa-thumbs-up blue-like fs-4"></i><span class="blue-like">Like</span>
              {% else %}
              <i class="fa-solid fa-thumbs-up"></i>Like
              {% endif %}

            </button>
          </form>


          <button class="col-4 btn" onclick="commentForm({{post.id}})">
            <i class="fa-solid fa-comment"></i> Comment
          </button>
          <button class="col-4 btn">
            <i class="fa-solid fa-share-nodes"></i> Share
          </button>
        </div>
        <div class="row comment-form-{{post.id}} d-none">
          <form method="post" action="/posts/create_comment/{{post.id}}/">
            {{ comment_form | crispy }}
            {% csrf_token %}
            <div class="text-end"><button type="submit" class="general-btn btn rounded-5 my-2">Submit</button></div>
            
          </form>
        </div>
        <hr class="m-0">
{% for comment in comments %}
<div class="dark-boxes rounded-5 mx-3 my-2">
  <div class=" rounded-pill post-options dropdown text-end">
    <button class="btn dropdown-toggle rounded-circle position-relative mx-3" type="button" data-bs-toggle="dropdown"
      aria-expanded="false">
      <i class="fa-solid fa-ellipsis position-absolute top-50 start-50 translate-middle"></i>
    </button>
    <ul class="dropdown-menu">
      {% if post.author == user %}
      <li><a class="dropdown-item" href="/posts/edit_comment/{{comment.id}}">Edit</a></li>
      <li><a class="dropdown-item" href="/posts/delete_comment/{{comment.id}}">Delete</a></li>
      {% else %}
      <li><a class="dropdown-item" href="#">Share post</a>
      <li><a class="dropdown-item" href="#">Report</a></li>
      {% endif %}
    </ul>
  </div>
  <div class="d-flex flex-row">
    <img src="{{comment.post.author.profile.avatar_url}}" alt="profile picture of user that commented on post"
      class="profile-image-post rounded-circle shadow-sm mx-3">
    <h6>{{comment.name}}</h6>
  </div>

  <p class="text-center">{{comment.comment}}</p>
  <p class="text-end"></p>
  <div class="row user-post-options m-0">
    <form class="like-btn col-12 mx-4" action="/posts/like_comment/{{comment.id}}">
      {% csrf_token %}
      <button class="btn">
        {% if user in comment.likes.all %}
        <i class="fa-solid fa-thumbs-up blue-like fs-4"></i><span class="blue-like">Like</span>
        {% else %}
        <i class="fa-solid fa-thumbs-up"></i>Like
        {% endif %}

      </button>
    </form>
  </div>
</div>
{% endfor %}
      </div>
      
    </div>

    <div class="col-sm-12 col-md-5 mt-4">

      {% include "footer.html" %}
    </div>
  </div>
</div>
{% endblock %}