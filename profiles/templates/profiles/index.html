{% extends "base.html" %}
{% load static %}
{% load crispy_forms_tags %}
{% block content %}
<div class="container">
    <div class="row  position-relative gx-0">
        <div class="col-sm-12 col-md-7 col-lg-9">
            <img src="{{profile.background_url}}" alt="user profile background"
                class="user-bg shadow-sm rounded-3 w-100">
            <div class="col-5">
                <div>
                    <img class="profile-img-profile my-2 rounded-circle shadow-sm position-absolute top-0 start-0 mx-4"
                        src="{{ profile.avatar_url }}" alt="current user profile image">
                    {% if profile.first_name %}
                    <h6>{{profile.first_name}}</h6>
                    {% endif %}
                </div>

            </div>
        </div>
        <div class="col-sm-12 col-md-5 col-lg-3 gx-0">
            <div class="content-box shadow-sm rounded-3 mx-3">
                People you may know
            </div>
        </div>
    </div>
    <div class="row gx-0">
        <div class="user-bio">
            {{profile.bio}}
        </div>
        <div class="col-sm-12 col-md-4 gx-0"></div>
        <div class="col-sm-12 col-md-5 gx-0">
            <div class="content-box post-box w-100 shadow-sm rounded-3 p-2 boxes">
                <div class="row">
                    <div class="col-2">
                        <img class="profile-image-post rounded-circle shadow-sm " src="{{ profile.avatar_url }}"
                            alt="profile image of author"></div>
                    <div class="col-10">
                        <button class="btn create-post-btn w-100 rounded-pill text-start" type="button"
                            aria-label="Click here to create a post" data-bs-toggle="modal"
                            data-bs-target="#feed-create-post">Create
                            a
                            post</button></div>
                </div>
            </div>
            {% for post in posts %}
            <div class="content-box w-100 shadow-sm rounded mt-2 py-1 px-2 boxes">
                <div class="post-options dropdown position-relative text-end" id="post-{{post.id}}">
                    <button class="btn dropdown-toggle rounded-circle position-relative mx-1" type="button"
                        data-toggle="dropdown" aria-expanded="false" data-flip="false"
                        onclick="postDropdown({{post.id}})">
                        <i class="fa-solid fa-ellipsis position-absolute top-50 start-50 translate-middle"></i>
                    </button>
                    <ul class="dropdown-menu post-dropdown-{{post.id}} position-absolute top-100 end-0">
                        {% if post.author == user %}
                        <li><a class="dropdown-item" href="/posts/edit/{{post.id}}">Edit</a></li>
                        <li><a class="dropdown-item" href="/posts/delete/{{post.id}}">Delete</a></li>
                        {% else %}
                        <li><a class="dropdown-item" href="#">Share post</a>
                        <li><a class="dropdown-item" href="#">Report</a></li>
                        {% endif %}
                    </ul>
                </div>
                <div class="author-post">
                    <div class="w-100 d-flex flex-row">
                        <img class="profile-image-post rounded-circle shadow-sm mx-3"
                            src="{{ post.author.profile.avatar_url }}" alt="profile image of author">
                    </div>
                    <ul class="list-style-none">
                        <a class="mx-3 fs-6">{{post.author}}</a>
                        <p class="mx-3 small-and-light">{{post.calc_time_since}}</p>
                    </ul>
                </div>
                <a href="{% url 'view_post' post.slug %}" class="post-link text-decoration-none">
                    <h5 class="w-100 text-center">{{post.title}}</h5>
                    <p class="text-center">{{post.post_body}}</p>
                </a>

                <div class="row mx-3 g-0">
                    <p class="col-6 w-50 text-start">
                        {% if post.count_likes > 0%}
                        {{post.count_likes}} Likes
                        {% endif %}
                    </p>
                    <p class="col-6 w-50 text-end">
                        {% if post.count_comments > 0 %}
                        <a href="{% url 'view_post' post.slug %}">{{post.count_comments}}
                            Comments</a>
                        {% endif %}
                    </p>
                </div>

                <hr class="m-0">
                <div class="row user-post-options m-0">
                    <form class="like-btn col-4" action="/posts/like_post/{{post.id}}">
                        {% csrf_token %}
                        <button class="btn w-100">
                            {% if user in post.likes.all %}
                            <i class="fa-solid fa-thumbs-up blue-like fs-4"></i><span class="blue-like">Like</span>
                            {% else %}
                            <i class="fa-solid fa-thumbs-up"></i>Like
                            {% endif %}

                        </button>
                    </form>
                    <button class="col-4 btn" onclick="commentForm({{post.id}})">
                        <i class="fa-solid fa-comment"></i> Comment
                    </button>
                    <button class="col-4 btn">
                        <i class="fa-solid fa-share-nodes"></i> Share
                    </button>
                </div>
                <div class="row comment-form-{{post.id}} d-none">
                    <form method="post" action="/posts/create_comment/{{post.id}}/">
                        {{ comment_form | crispy }}
                        {% csrf_token %}
                        <div class="text-end"><button type="submit"
                                class="general-btn btn rounded-5 my-2">Submit</button></div>
                    </form>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>
<!-- Modal -->
<div class="modal-container">
</div>
{% endblock %}