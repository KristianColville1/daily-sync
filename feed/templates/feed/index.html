{% extends "base.html" %}
{% load static %}

{% load crispy_forms_tags %}

{% block content %}
<div class="container">
  <div class="row mt-2">
    <div class="col-sm-12 col-md-3 col-lg-2 d-none d-sm-none d-md-block">
      <div class="profile-pic-md position-relative">
        <img src="{{profile.background_url}}" alt="profile background image"
          class="shadow-sm rounded w-100 border position-absolute">
        <img class="profile-image-feed rounded-circle shadow-sm position-absolute top-50 start-50 translate-middle"
          src="{{ profile.avatar_url }}" alt="current user profile image">
      </div>
      <div class="mt-5">
        <div class="list-group feed-profile-options">
          <a href="#" class="list-group-item list-group-item-action"><i class="fa-solid fa-user"></i> Profile</a>
          <a href="#" class="list-group-item list-group-item-action"><i class="fa-solid fa-users"></i> Friends</a>
          <a href="#" class="list-group-item list-group-item-action"><i class="fa-solid fa-user-group"></i>
            Followers</a>
          <a href="#" class="list-group-item list-group-item-action"><i class="fa-solid fa-message"></i>
            Messages</a>
          <a href="{% url 'chat' %}" class="list-group-item list-group-item-action"><i class="fa-solid fa-comments"></i></i>
            Chat Rooms</a>
        </div>
      </div>
    </div>
    <div class="col-sm-12 col-md-6 col-lg-6 mb-2">
      <div class="content-box post-box w-100 shadow-sm border rounded-3 p-2 boxes">
        <div class="row">
          <div class="col-2">
            <img class="profile-image-post rounded-circle border shadow-sm" src="{{ profile.avatar_url }}"
              alt="profile image of author"></div>
          <div class="col-10">
            <button class="btn create-post-btn w-100 rounded-pill border text-start" type="button"
              aria-label="Click here to create a post" data-bs-toggle="modal" data-bs-target="#feed-create-post">Create
              a
              post</button></div>
        </div>
      </div>
      {% for post in posts %}
      <div class="content-box w-100 shadow-sm rounded border mt-2 py-1 px-2 boxes">
        <div class="post-options dropdown position-relative text-end" id="post-{{post.id}}">
          <button aria-label="Click here to show the options you can use on a post"
            class="btn dropdown-toggle rounded-circle position-relative mx-1" type="button" type="button"
            data-toggle="dropdown" aria-expanded="false" data-flip="false" onclick="postDropdown({{post.id}})">
            <i class="fa-solid fa-ellipsis position-absolute top-50 start-50 translate-middle"></i>
          </button>
          <ul class="dropdown-menu post-dropdown-{{post.id}} position-absolute top-100 end-0"
            style="width: fit-content;">
            {% if post.author == user %}
            <li><a class="dropdown-item" href="/posts/edit/{{post.id}}">Edit</a></li>
            <li><a class="dropdown-item" href="/posts/delete/{{post.id}}">Delete</a></li>
            {% else %}
            <li><a class="dropdown-item" href="#">Share post</a>
            <li><a class="dropdown-item" href="#">Report</a></li>
            {% endif %}
          </ul>
        </div>
        <div class="author-post">
          <div class="w-100 d-flex flex-row">
            <img class="profile-image-post rounded-circle shadow-sm mx-3" src="{{ post.author.profile.avatar_url }}"
              alt="profile image of author">
          </div>
          <ul class="list-group list-unstyled">
            <li class="list-item"><a class="mx-3 fs-6" href="/profiles/view_profile/{{post.author.profile.slug}}">{{post.author}}</a></li>
            <li class="list-item"><p class="mx-3 small-and-light">{{post.calc_time_since}}</p></li>
          </ul>
        </div>
        <a href="{% url 'view_post' post.slug %}" class="post-link text-decoration-none">
          <p class="text-center">{{post.post_body}}</p>
        </a>
        <div class="row mx-3 g-0">
          <p class="col-6 w-50 text-start">
            {% if post.count_likes > 0%}
            {{post.count_likes}} Likes
            {% endif %}
          </p>
          <p class="col-6 w-50 text-end">
            {% if post.count_comments > 0 %}
            <a href="{% url 'view_post' post.slug %}">{{post.count_comments}}
              Comments</a>
            {% endif %}
          </p>
        </div>

        <hr class="m-0">
        <div class="row user-post-options m-0">
          <div class="likes-container col-4 position-relative gx-0">
            <form class="like-btn position-absolute w-100" action="/posts/like_post/{{post.id}}/like/">
              {% csrf_token %}
              <button name="Like button" class="likes btn w-100"
                aria-label="Click here to leave a emoji like on a post">
                {% if user in post.thumbs_likes.all %}
                <i class="fa-solid fa-thumbs-up blue-like fs-4"></i><span> Like</span>
                {% elif user in post.heart_likes.all %}
                <i class="fa-solid fa-heart fs-4"></i><span> Love</span>
                {% elif user in post.laugh_likes.all %}
                <i class="fa-solid fa-face-laugh-squint fs-4"></i><span> Laugh</span>
                {% elif user in post.angry_likes.all %}
                <i class="fa-solid fa-face-angry fs-4"></i><span> Angry</span>
                {% else %}
                <i class="fa-solid fa-thumbs-up"></i> Like
                {% endif %}
              </button>
            </form>
            <div class="emojies boxes shadow-sm rounded d-flex flex-row p-2">
              <form action="/posts/like_post/{{post.id}}/like/">
                {% csrf_token %}
                <button class="btn"><i class="fa-solid fa-thumbs-up blue-like"></i></button>
              </form>
              <form action="/posts/like_post/{{post.id}}/love/">
                {% csrf_token %}
                <button class="btn"><i class="fa-solid fa-heart"></i></button>
              </form>
              <form action="/posts/like_post/{{post.id}}/laugh/">
                {% csrf_token %}
                <button class="btn"><i class="fa-solid fa-face-laugh-squint"></i></button>
              </form>
              <form action="/posts/like_post/{{post.id}}/angry/">
                {% csrf_token %}
                <button class="btn"><i class="fa-solid fa-face-angry"></i></button>
              </form>
            </div>
          </div>
          <button class="col-4 btn" onclick="commentForm({{post.id}})">
            <i class="fa-solid fa-comment"></i> Comment
          </button>
          <button class="col-4 btn">
            <i class="fa-solid fa-share-nodes"></i> Share
          </button>
        </div>
        <div class="row comment-form-{{post.id}} d-none">
          <form method="post" action="/posts/create_comment/{{post.id}}/">
            {{ comment_form | crispy }}
            {% csrf_token %}
            <div class="text-end"><button type="submit" class="general-btn btn rounded-5 my-2">Submit</button></div>
          </form>
        </div>
      </div>
      {% endfor %}
      <div class="pagination boxes shadow-sm rounded border mt-2 py-2">
        <div class="step-links">
          {% if posts.has_previous %}
          <a href="?page=1" class="btn general-btn  py-1 px-2 mx-3 rounded">&laquo; first</a>
          <a href="?page={{ posts.previous_page_number }}" class="btn general-btn  py-1 px-2 mx-3 rounded">previous</a>
          {% endif %}
          {% if posts.has_next %}
          <a href="?page={{ posts.next_page_number }}" class="btn general-btn py-1 px-2 mx-3 rounded">next</a>
          <a href="?page={{ posts.paginator.num_pages }}" class="btn general-btn  py-1 px-2 mx-3 rounded">last
            &raquo;</a>
          {% endif %}
        </div>
      </div>
    </div>
    <div class="col-sm-12 col-md-3 col-lg-4">
      <div class="content-box shadow-sm rounded border w-100">
        <h6 class="text-center py-2"> People you may know <i class="fa-solid fa-angle-down"></i>
        </h6>
        {% for persons in profiles %}
        <div class="d-flex flex-row mx-3">
          <div class="mx-4 d-flex flex-row w-50">
              <img class="user-post-image  my-2 rounded-circle shadow-sm  border" src="{{ persons.avatar_url }}"
              alt="current user profile image" class="position-absolute">
          <a href="/profiles/view_profile/{{persons.slug}}" aria-label="click link to go to users profile"
              class="my-auto"> 
              <p>{{persons.user}}</p>
          </a>
          </div>
          <div class="w-50 my-3">
              <form action="/profiles/follow_profile/{{persons.id}}">
                  <button class="btn btn-light mx-auto"><i class="fa-solid fa-plus"></i> Follow</button>
              </form>
          </div>
      </div>
        {% endfor %}
        <div class="pagination boxes shadow-sm rounded mt-2 py-2">
          <div class="step-links">
            {% if profiles.has_previous %}
            <a href="?page=1" class="py-1 px-2 mx-3 rounded">&laquo; first</a>
            <a href="?page={{ profiles.previous_page_number }}" class="py-1 px-2 mx-3 rounded">previous</a>
            {% endif %}
            {% if profiles.has_next %}
            <a href="?page={{ profiles.next_page_number }}" class="py-1 px-2 mx-3 rounded">next</a>
            <a href="?page={{ profiles.paginator.num_pages }}" class="py-1 px-2 mx-3 rounded">last
              &raquo;</a>
            {% endif %}
          </div>
        </div>
      </div>
      <div class="content-box w-100 shadow-sm rounded p-2 mt-2 border boxes">
        <h6 class="text-center">Messages</h6>

      </div>
      <div class="w-100 shadow-sm rounded border mt-2 overflow-hidden">
        {% include "footer.html" %}
      </div>
    </div>
  </div>
</div>

{% endblock %}